unique_name: factinternetsalesreason
object_type: dataset
label: factinternetsalesreason
columns:
  - name: salesordernumber
    data_type: string
  - name: salesreasonkey
    data_type: long
  - name: orderdatekey
    data_type: long
  - name: salesreasonalternatekey
    data_type: long
  - name: salesreasonname
    data_type: string
  - name: salesreasonreasontype
    data_type: string
  - name: RowIndex
    data_type: long
  - name: RankedStatus
    data_type: string
  - name: SO_sum
    data_type: long
connection_id: con_atscale-sales-demo_Security_DIM_AM
sql: |-
  WITH RSR AS 
  (
    SELECT 
  salesordernumber,
  R.salesreasonkey,
  orderdatekey,
  salesreasonalternatekey,
  salesreasonname,
  salesreasonreasontype,
  1 as SO_sum,
  ROW_NUMBER() OVER ( PARTITION BY salesordernumber ) as RowIndex

  FROM `atscale-sales-demo.Security_DIM_AM.Sales_Reason_fact` R
  INNER JOIN `atscale-sales-demo.as_adventure_small_training.dimsalesreason` S

  ON S.salesreasonkey = R.salesreasonkey

  GROUP BY
  salesordernumber,
  R.salesreasonkey,
  orderdatekey,
  salesreasonalternatekey,
  salesreasonname,
  salesreasonreasontype
  ) 

  SELECT *, Concat(RowIndex, " - ",salesreasonname) as RankedStatus From RSR
